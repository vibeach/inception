{% extends "base.html" %}

{% block title %}New Project - Inception{% endblock %}

{% block content %}
<h1 style="font-size: 28px; color: #60a5fa; margin-bottom: 20px;">Create New Project</h1>

<div class="card">
    <form method="POST" id="project-form">
        <!-- Automated Creation Toggle -->
        <div style="background: #1e293b; border: 2px solid #3b82f6; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
            <label style="display: flex; align-items: center; cursor: pointer; font-size: 16px; color: #60a5fa;">
                <input type="checkbox" id="auto-create" name="auto_create" style="width: auto; margin-right: 10px;" onchange="toggleAutoCreate()">
                <strong>ðŸš€ Automatically create GitHub repo and deploy to Render</strong>
            </label>
            <p style="color: #94a3b8; font-size: 14px; margin-top: 8px; margin-left: 28px;">
                When checked, Inception will create a new GitHub repository with a starter template,
                initialize it with code, and automatically deploy it to Render. Perfect for new projects!
            </p>
        </div>
        <div class="grid grid-2">
            <div class="form-group">
                <label for="name">Project Name *</label>
                <input type="text" id="name" name="name" required>
            </div>

            <div class="form-group">
                <label for="project_type">Project Type</label>
                <select id="project_type" name="project_type">
                    <option value="">Select...</option>
                    <option value="Flask">Flask</option>
                    <option value="Django">Django</option>
                    <option value="Node.js">Node.js</option>
                    <option value="React">React</option>
                    <option value="Next.js">Next.js</option>
                    <option value="Other">Other</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="3"></textarea>
        </div>

        <!-- Manual entry fields (hidden when auto-create is checked) -->
        <div id="manual-fields">
        <div class="grid grid-2">
            <div class="form-group">
                <label for="repo_url">Git Repository URL *</label>
                <input type="text" id="repo_url" name="repo_url" placeholder="https://github.com/user/repo.git" required>
            </div>

            <div class="form-group">
                <label for="repo_branch">Branch</label>
                <input type="text" id="repo_branch" name="repo_branch" value="main">
            </div>
        </div>

        <div class="grid grid-2">
            <div class="form-group">
                <label for="local_path">Local Path</label>
                <input type="text" id="local_path" name="local_path" placeholder="/path/to/project">
            </div>

            <div class="form-group">
                <label for="github_token">GitHub Token (optional)</label>
                <input type="text" id="github_token" name="github_token" placeholder="ghp_...">
                <small style="color: #64748b; font-size: 12px;">Leave empty to use default token</small>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="form-group">
                <label for="render_service_id">Render Service ID (optional)</label>
                <input type="text" id="render_service_id" name="render_service_id" placeholder="srv-...">
            </div>

            <div class="form-group">
                <label for="render_service_url">Render Service URL (optional)</label>
                <input type="text" id="render_service_url" name="render_service_url" placeholder="https://...">
            </div>
        </div>
        </div> <!-- End manual-fields -->

        <!-- Auto-create only fields -->
        <div id="auto-fields" style="display: none;">
            <div class="form-group">
                <label>
                    <input type="checkbox" name="private_repo" style="width: auto; margin-right: 5px;">
                    Make repository private
                </label>
            </div>

            <div class="grid grid-2">
                <div class="form-group">
                    <label for="render_api_key">Render API Key (optional)</label>
                    <input type="text" id="render_api_key" name="render_api_key" placeholder="Will use RENDER_API_KEY env var">
                    <small style="color: #64748b; font-size: 12px;">Leave empty to use configured key</small>
                </div>

                <div class="form-group">
                    <label for="render_owner_id">Render Owner ID (optional)</label>
                    <input type="text" id="render_owner_id" name="render_owner_id" placeholder="Will use RENDER_OWNER_ID env var">
                    <small style="color: #64748b; font-size: 12px;">Leave empty to use configured ID</small>
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button type="submit" class="btn btn-primary" id="submit-btn">Create Project</button>
            <a href="/" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
function toggleAutoCreate() {
    const autoCreate = document.getElementById('auto-create').checked;
    const autoFields = document.getElementById('auto-fields');
    const manualFields = document.getElementById('manual-fields');
    const submitBtn = document.getElementById('submit-btn');

    // Get all input fields in manual section
    const manualInputs = manualFields.querySelectorAll('input, select, textarea');

    if (autoCreate) {
        // Show auto-create fields, hide manual fields
        autoFields.style.display = 'block';
        manualFields.style.display = 'none';

        // Disable all manual fields to prevent validation
        manualInputs.forEach(input => {
            input.disabled = true;
            input.required = false;
        });

        // Update button text
        submitBtn.textContent = 'ðŸš€ Create & Deploy Project';
        submitBtn.classList.remove('btn-primary');
        submitBtn.classList.add('btn-success');
    } else {
        // Show manual fields, hide auto-create fields
        autoFields.style.display = 'none';
        manualFields.style.display = 'block';

        // Re-enable manual fields
        manualInputs.forEach(input => {
            input.disabled = false;
        });

        // Make repo URL required again
        document.getElementById('repo_url').required = true;

        // Update button text
        submitBtn.textContent = 'Create Project';
        submitBtn.classList.remove('btn-success');
        submitBtn.classList.add('btn-primary');
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleAutoCreate();
});
</script>
{% endblock %}
